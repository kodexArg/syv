---
// Componente simplificado para toggle del sidebar
---

<button id="toggle-sidebar" class="sidebar-toggle-navbar" title="Sidebar">
  <i id="sidebar-icon" class="fas fa-bars"></i>
</button>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const toggleButton = document.getElementById('toggle-sidebar');
    const sidebarIcon = document.getElementById('sidebar-icon');
    const sidebar = document.getElementById('sidebar');
    const main = document.getElementById('main-content');

    function updateIcon() {
      const isVisible = sidebar?.classList.contains('sidebar-open');
      
      if (sidebarIcon) {
        sidebarIcon.className = isVisible ? 'fas fa-times' : 'fas fa-bars';
        toggleButton?.setAttribute('title', isVisible ? 'Ocultar Sidebar' : 'Mostrar Sidebar');
      }
    }

    function closeSidebar() {
      sidebar?.classList.remove('sidebar-open');
      main?.classList.remove('main-with-sidebar');
      // Guardar el estado de cierre manual en sessionStorage
      sessionStorage.setItem('sidebarClosedByUser', 'true');
      updateIcon();
    }

    function openSidebar() {
      sidebar?.classList.add('sidebar-open');
      main?.classList.add('main-with-sidebar');
      // Limpiar el estado de cierre manual
      sessionStorage.removeItem('sidebarClosedByUser');
      updateIcon();
    }

    function toggleSidebar() {
      const willBeOpen = !sidebar?.classList.contains('sidebar-open');
      
      if (willBeOpen) {
        openSidebar();
      } else {
        closeSidebar();
      }
    }

    // Event listener para el toggle button
    toggleButton?.addEventListener('click', toggleSidebar);
    
    // Event listener para cerrar sidebar al hacer click en enlaces
    if (sidebar) {
      sidebar.addEventListener('click', (event) => {
        // Verificar si el elemento clickeado es un enlace
        const target = event.target as HTMLElement;
        const link = target.closest('a');
        
        if (link && link.href) {
          // Cerrar el sidebar al hacer click en cualquier enlace
          closeSidebar();
        }
      });
    }
    
    // Estado inicial basado en pantalla y preferencias del usuario
    const isDesktop = window.innerWidth >= 768;
    const wasClosedByUser = sessionStorage.getItem('sidebarClosedByUser') === 'true';
    
    // Solo abrir automáticamente en desktop si el usuario no lo cerró previamente
    if (isDesktop && !wasClosedByUser) {
      openSidebar();
    } else {
      sidebar?.classList.remove('sidebar-open');
      main?.classList.remove('main-with-sidebar');
      updateIcon();
    }
  });
</script> 