---
---

<button 
  id="toggle-sidebar" 
  class="bg-olive-600 text-white border-none w-8 h-8 rounded cursor-pointer flex items-center justify-center transition-colors duration-200 hover:bg-olive-700" 
  title="Sidebar"
  aria-label="Toggle sidebar"
>
  <i id="sidebar-icon" class="fas fa-bars text-sm" aria-hidden="true"></i>
</button>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const elements = {
      button: document.getElementById('toggle-sidebar'),
      icon: document.getElementById('sidebar-icon'),
      sidebar: document.getElementById('sidebar'),
      main: document.getElementById('main-content')
    } as const;

    const state = {
      get isOpen() {
        return elements.sidebar?.classList.contains('sidebar-open') ?? false;
      },
      get isDesktop() {
        return window.innerWidth >= 768;
      },
      get wasClosedByUser() {
        return sessionStorage.getItem('sidebarClosedByUser') === 'true';
      }
    };

    const updateUI = () => {
      if (!elements.icon || !elements.button) return;
      
      const isVisible = state.isDesktop ? !state.wasClosedByUser : state.isOpen;
      elements.icon.className = isVisible ? 'fas fa-times' : 'fas fa-bars';
      elements.button.setAttribute('title', isVisible ? 'Ocultar Sidebar' : 'Mostrar Sidebar');
      elements.button.setAttribute('aria-label', isVisible ? 'Ocultar sidebar' : 'Mostrar sidebar');
    };

    const setSidebarState = (open: boolean) => {
      if (!elements.sidebar || !elements.main) return;
      
      elements.sidebar.classList.toggle('sidebar-open', open);
      elements.main.classList.toggle('main-with-sidebar', open);
      
      if (open) {
        sessionStorage.removeItem('sidebarClosedByUser');
      } else {
        sessionStorage.setItem('sidebarClosedByUser', 'true');
      }
      
      updateUI();
    };

    const handleToggle = () => setSidebarState(!state.isOpen);

    const handleLinkClick = (event: Event) => {
      const target = event.target as HTMLElement;
      const link = target?.closest('a');
      if (link?.href && !state.isDesktop) {
        setSidebarState(false);
      }
    };

    const handleResize = () => {
      if (state.isDesktop) {
        if (state.wasClosedByUser) {
          setSidebarState(false);
        } else {
          elements.sidebar?.classList.remove('sidebar-open');
          elements.main?.classList.remove('main-with-sidebar');
          updateUI();
        }
      } else {
        setSidebarState(false);
      }
    };

    elements.button?.addEventListener('click', handleToggle);
    elements.sidebar?.addEventListener('click', handleLinkClick);
    window.addEventListener('resize', handleResize);
    
    handleResize();
  });
</script>