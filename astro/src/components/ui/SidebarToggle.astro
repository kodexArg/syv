---
// Componente simplificado para toggle del sidebar
---

<button id="toggle-sidebar" class="bg-olive-600 text-white border-none w-8 h-8 rounded cursor-pointer flex items-center justify-center transition-colors duration-200 hover:bg-olive-700" title="Sidebar">
  <i id="sidebar-icon" class="fas fa-bars text-sm"></i>
</button>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const elements = {
      button: document.getElementById('toggle-sidebar'),
      icon: document.getElementById('sidebar-icon'),
      sidebar: document.getElementById('sidebar'),
      main: document.getElementById('main-content')
    };

    const state = {
      get isOpen() {
        return elements.sidebar?.classList.contains('sidebar-open') || false;
      },
      get isDesktop() {
        return window.innerWidth >= 768;
      },
      get wasClosedByUser() {
        return sessionStorage.getItem('sidebarClosedByUser') === 'true';
      }
    };

    function updateUI() {
      if (!elements.icon || !elements.button) return;
      
      const isVisible = state.isDesktop ? !state.wasClosedByUser : state.isOpen;
      elements.icon.className = isVisible ? 'fas fa-times' : 'fas fa-bars';
      elements.button.setAttribute('title', isVisible ? 'Ocultar Sidebar' : 'Mostrar Sidebar');
    }

    function setSidebarState(open: boolean) {
      if (!elements.sidebar || !elements.main) return;
      
      elements.sidebar.classList.toggle('sidebar-open', open);
      elements.main.classList.toggle('main-with-sidebar', open);
      
      if (open) {
        sessionStorage.removeItem('sidebarClosedByUser');
      } else {
        sessionStorage.setItem('sidebarClosedByUser', 'true');
      }
      
      updateUI();
    }

    function handleToggle() {
      setSidebarState(!state.isOpen);
    }

    function handleLinkClick(event: Event) {
      const target = event.target as HTMLElement;
      const link = target?.closest('a');
      if (link?.href && !state.isDesktop) {
        setSidebarState(false);
      }
    }

    function handleResize() {
      if (state.isDesktop) {
        if (state.wasClosedByUser) {
          setSidebarState(false);
        } else {
          elements.sidebar?.classList.remove('sidebar-open');
          elements.main?.classList.remove('main-with-sidebar');
          updateUI();
        }
      } else {
        setSidebarState(false);
      }
    }

    elements.button?.addEventListener('click', handleToggle);
    elements.sidebar?.addEventListener('click', handleLinkClick);
    window.addEventListener('resize', handleResize);
    
    handleResize();
  });
</script>