---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Icon from '../../components/ui/Icon.astro';

export async function getStaticPaths() {
  const collections = ['proyecto', 'trasfondo', 'atlas', 'personajes', 'diegesis', 'aventuras', 'media'] as const;
  
  return collections.map((collectionName) => ({
    params: { collection: collectionName },
    props: { collectionName },
  }));
}

const { collectionName } = Astro.props;

const collectionDisplayNames = {
  'proyecto': 'Proyecto', 'trasfondo': 'Trasfondo', 'atlas': 'Atlas', 'personajes': 'Personajes',
  'diegesis': 'Diégesis', 'aventuras': 'Aventuras', 'media': 'Media'
} as const;

const collectionIcons = {
  'proyecto': 'folder', 'trasfondo': 'book', 'atlas': 'map', 'personajes': 'users',
  'diegesis': 'document', 'aventuras': 'lightning', 'media': 'photo'
} as const;

const displayName = collectionDisplayNames[collectionName as keyof typeof collectionDisplayNames] || collectionName;
const icon = collectionIcons[collectionName as keyof typeof collectionIcons] || 'document';

let entries: any[] = [];

try {
  entries = await getCollection(collectionName as any);
} catch (error) {
  // Colección no disponible
}
---

<BaseLayout 
  title={displayName}
  description={`Documentación de ${displayName} - Subordinación y Valor`}
  currentPath={Astro.url.pathname}
>
  <div class="max-w-4xl mx-auto">
    <header>
      <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-olive-100 text-olive-800 gap-2 mb-4">
        <Icon name={icon} size="sm" />
        Colección
      </span>
      
      <h1>{displayName}</h1>
      <p>Explorar todos los documentos de la colección {displayName}</p>
    </header>

    <div class="grid grid-cols-[repeat(auto-fill,minmax(20rem,1fr))] gap-4 mt-8 md:grid-cols-1">
      {entries.map(entry => (
        <a href={`/docs/${entry.collection}/${entry.id}`} class="p-4 bg-white border border-military-200 rounded-md flex items-start gap-4 no-underline transition-colors duration-150 hover:border-olive-400">
          <Icon name="document-solid" size="sm" />
          <div>
            <h3 class="font-medium text-military-800 mb-1 m-0">{entry.data.titulo || entry.id.split('/').pop()}</h3>
            {entry.data.descripcion && (
              <p class="text-sm text-military-600 m-0">{entry.data.descripcion}</p>
            )}
          </div>
        </a>
      ))}
    </div>

    {entries.length === 0 && (
      <div class="text-center py-12">
        <Icon name="document" />
        <h3 class="text-lg font-medium text-military-800 mb-2">No hay documentos disponibles</h3>
        <p class="text-military-600">Esta colección no contiene documentos en este momento.</p>
      </div>
    )}
  </div>
</BaseLayout>