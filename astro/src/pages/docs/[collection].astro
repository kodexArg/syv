---
import { getCollection } from 'astro:content';
import { DOCUMENTS_SCHEMA, DOCUMENTS_SCHEMA_KEYS } from '../../content/constants';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Icon from '../../components/ui/Icon.astro';

export const getStaticPaths = () => 
  DOCUMENTS_SCHEMA_KEYS.map((collection) => ({
    params: { collection },
    props: { collectionKey: collection },
  }));

interface Props {
  collectionKey: string;
}

const { collectionKey } = Astro.props;

const collectionData = DOCUMENTS_SCHEMA[collectionKey as keyof typeof DOCUMENTS_SCHEMA];
const fullName = collectionData?.name || '';
const icon = collectionData?.icon || 'document';

let entries: any[] = [];
try {
  entries = await getCollection(collectionKey as any);
} catch {
  entries = [];
}
---

<BaseLayout 
  title={fullName}
  description={`Documentation for ${fullName} - SubordinaciÃ³n y Valor`}
  currentPath={Astro.url.pathname}
>
  <div class="max-w-4xl mx-auto">
    <header>
      <span class="inline-flex items-center gap-2 px-3 py-1 rounded-full text-sm font-medium bg-military-100 text-military-700 border border-military-200 mb-4">
        <Icon name={icon} size="sm" />
        Collection
      </span>
      
      <h1>{fullName}</h1>
      <p>Explore all documents in the {fullName} collection</p>
    </header>

    {entries.length > 0 ? (
      <div class="grid grid-cols-[repeat(auto-fill,minmax(20rem,1fr))] gap-4 mt-8 md:grid-cols-1">
        {entries.map((entry: any) => (
          <a 
            href={`/docs/${entry.collection}/${entry.id}/`}
            class="p-4 bg-white border border-military-200 rounded-md flex items-start gap-4 no-underline transition-colors duration-150 hover:border-olive-400"
          >
            <Icon name="document-solid" size="sm" />
            <div>
              <h3 class="font-medium text-military-800 mb-1 m-0">
                {entry.data?.titulo || entry.id.split('/').pop() || 'Untitled'}
              </h3>
              {entry.data?.descripcion && (
                <p class="text-sm text-military-600 m-0">{entry.data.descripcion}</p>
              )}
            </div>
          </a>
        ))}
      </div>
    ) : (
      <div class="text-center py-12">
        <Icon name="document" />
        <h3 class="text-lg font-medium text-military-800 mb-2">No documents available</h3>
        <p class="text-military-600">This collection currently contains no documents.</p>
      </div>
    )}
  </div>
</BaseLayout>