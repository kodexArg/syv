---
import { getCollection, type CollectionEntry } from 'astro:content';
import { CLAVES_COLECCIONES, obtenerNombreCompleto, obtenerIcono, type ClaveColeccion } from '../../content/config';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Icon from '../../components/ui/Icon.astro';

export const getStaticPaths = () => 
  CLAVES_COLECCIONES.map((claveColeccion) => ({
    params: { collection: claveColeccion },
    props: { claveColeccion },
  }));

const { claveColeccion } = Astro.props;

const nombreCompleto = obtenerNombreCompleto(claveColeccion);
const icono = obtenerIcono(claveColeccion);

const entradas: CollectionEntry<ClaveColeccion>[] = await getCollection(claveColeccion as ClaveColeccion).catch(() => []);
---

<BaseLayout 
  title={nombreCompleto}
  description={`Documentación de ${nombreCompleto} - Subordinación y Valor`}
  currentPath={Astro.url.pathname}
>
  <div class="max-w-4xl mx-auto">
    <header>
      <span class="inline-flex items-center gap-2 px-3 py-1 rounded-full text-sm font-medium bg-military-100 text-military-700 border border-military-200 mb-4">
        <Icon name={icono} size="sm" />
        Colección
      </span>
      
      <h1>{nombreCompleto}</h1>
      <p>Explorar todos los documentos de la colección {nombreCompleto}</p>
    </header>

    {entradas.length > 0 ? (
      <div class="grid grid-cols-[repeat(auto-fill,minmax(20rem,1fr))] gap-4 mt-8 md:grid-cols-1">
        {entradas.map((entrada) => (
          <a 
            href={`/docs/${entrada.collection}/${entrada.id}/`} 
            class="p-4 bg-white border border-military-200 rounded-md flex items-start gap-4 no-underline transition-colors duration-150 hover:border-olive-400"
          >
            <Icon name="document-solid" size="sm" />
            <div>
              <h3 class="font-medium text-military-800 mb-1 m-0">
                {entrada.data.titulo || entrada.id.split('/').pop()}
              </h3>
              {entrada.data.descripcion && (
                <p class="text-sm text-military-600 m-0">{entrada.data.descripcion}</p>
              )}
            </div>
          </a>
        ))}
      </div>
    ) : (
      <div class="text-center py-12">
        <Icon name="document" />
        <h3 class="text-lg font-medium text-military-800 mb-2">No hay documentos disponibles</h3>
        <p class="text-military-600">Esta colección no contiene documentos en este momento.</p>
      </div>
    )}
  </div>
</BaseLayout>