---
import { getCollection, type CollectionEntry, render } from 'astro:content';
import { CLAVES_COLECCIONES, obtenerNombreCompleto, type ClaveColeccion } from '../../../content/config';
import BaseLayout from '../../../layouts/BaseLayout.astro';
import MarkdownLayout from '../../../layouts/MarkdownLayout.astro';

interface Props {
  entrada: CollectionEntry<ClaveColeccion>;
}

export const getStaticPaths = async () => {
  const rutas = await Promise.all(
    CLAVES_COLECCIONES.map(async (claveColeccion) => {
      try {
        const entradas = await getCollection(claveColeccion);
        return entradas.map((entrada) => ({
          params: { collection: claveColeccion, slug: entrada.id },
          props: { entrada },
        }));
      } catch {
        return [];
      }
    })
  );
  
  return rutas.flat();
};

const { entrada } = Astro.props;

const { Content, headings } = await render(entrada);
const nombreColeccion = obtenerNombreCompleto(Astro.params.collection || '');
---

<BaseLayout 
  title={entrada.data.titulo}
  description={entrada.data.descripcion}
  currentPath={Astro.url.pathname}
>
  <MarkdownLayout 
    titulo={entrada.data.titulo}
    descripcion={entrada.data.descripcion}
    collection={nombreColeccion}
    headings={headings}
    tags={entrada.data.tags}
    fecha={entrada.data.fecha ? new Date(entrada.data.fecha) : undefined}
    carpeta={entrada.data.carpeta}
  >
    <Content />
  </MarkdownLayout>
</BaseLayout>